<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./css/style.css" />
  <title>Document</title>
</head>
<body>
<div class="page">
  <div class="intro-area">ì†Œê°œì˜ì—­
    <div>
      <p onclick="refreshChat()" style="background-color: white; color: #007bff; border: none; cursor: pointer;">ğŸ”„ ìƒˆë¡œ ê³ ì¹¨</p>
    </div>
    
  </div>
  <div class="chat-area">
    <div class="chat-wrap">
      <div id="chat-body" class="chat-contents">
        <!-- <div class="chat-box">
          <div class="profile">
            <img src="/images/gpt_pofile.svg" alt="">
          </div>
          <div class="chat-text">
            <div class="name">GPT</div>
            <div class="chat-bubble">ì•ˆë…•! ì˜¤ëŠ˜ í•˜ë£¨ ì–´ë•Œ?</div>
          </div>
          <div class="send-time">ì˜¤í›„ 01:23</div>
        </div> -->
        <!-- <div class="chat-box sender">
          <div class="chat-text">
            <div class="chat-bubble">ì•ˆë…•í•˜ì„¸ìš”.</div>
          </div>
          <div class="send-time">ì˜¤í›„ 01:23</div>
        </div> -->
      </div>
      <div class="send-contents">
        <img class="attach" src="./images/ico_file.svg" alt="file" />
        <!-- <div >
        </div> -->
        <div class="input">
          <input id="user-input" type="text" />
          <img class="send" src="./images/ico_send.svg" alt="send" onclick="sendMessage()"/> 
        </div>
      </div>
    </div>
  </div>
</div>
<script src="./chatgpt.js"></script>
<script>

  // ì—”í„°í‚¤ ì…ë ¥ ê°ì§€
 document.getElementById('user-input').addEventListener('keydown', function(event) {
     // í‚¤ ì½”ë“œê°€ 13ì´ë©´ Enter í‚¤
     if (event.key === 'Enter') {
         sendMessage();  // sendMessage í•¨ìˆ˜ í˜¸ì¶œ
     }
 });


 sayBot('ì•ˆë…•! ì˜¤ëŠ˜ í•˜ë£¨ ì–´ë•Œ?');

 function sendMessage() {
     let input = document.getElementById('user-input');
     let message = input.value;
     if (message.trim() !== '') {
         let chatBody = document.getElementById('chat-body');

         // ì‚¬ìš©ì ë©”ì‹œì§€ í‘œì‹œ
         sayUser(message); 
         ChatGPTAPI.addUserMessage(message);

         let loadingMessage = document.createElement('div');
         loadingMessage.classList.add('chat-box', 'temp');

         let html = '<div class="profile"><img src="./images/gpt_pofile.svg" alt=""></div>';
         html += '<div class="chat-text">';
         html += '  <div class="name">GPT</div>';
         html += '  <div class="chat-bubble">...</div>';
         html += '</div>';
         html += '<div class="send-time">' + getFormattedNowTime() + '</div>';

         loadingMessage.innerHTML = html;

         chatBody.appendChild(loadingMessage);


         // ì±—ë´‡ ì‘ë‹µ í‘œì‹œ (ê°„ë‹¨í•œ ì˜ˆì‹œ ì‘ë‹µ)
         ChatGPTAPI.sendRequest().then((responseMessage) => {
             sayBot(responseMessage);  // ì‘ë‹µ ë©”ì‹œì§€ë¥¼ sayBot í•¨ìˆ˜ì— ì „ë‹¬
         }).catch((error) => {
             sayBot('ì£„ì†¡í•©ë‹ˆë‹¤. ì‘ë‹µì„ ê°€ì ¸ì˜¤ëŠ” ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
             console.error('Error:', error);
         });

         // ì…ë ¥ì°½ ë¹„ìš°ê¸°
         input.value = '';

         // ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ ë‚´ë¦¬ê¸°
         chatBody.scrollTop = chatBody.scrollHeight;
     }
 }
 


 // ì±—ë´‡ ì‘ë‹µ í‘œì‹œ 
 function sayBot(message) {
     // ë¡œë”© ë©”ì‹œì§€ë¥¼ ì‚­ì œ
     let loadingMessage = document.querySelector('.temp');
     if (loadingMessage) {
         loadingMessage.remove();  // ë¡œë”© ë©”ì‹œì§€ ì œê±°
     }

     let chatBody = document.getElementById('chat-body');
     let botMessage = document.createElement('div');
     botMessage.classList.add('chat-box');
     let html = '<div class="profile"><img src="./images/gpt_pofile.svg" alt=""></div>';
     html += '<div class="chat-text">';
     html += '  <div class="name">GPT</div>';
     html += '  <div class="chat-bubble">' + message + '</div>';
     html += '</div>';
     html += '<div class="send-time">' + getFormattedNowTime() + '</div>';

     botMessage.innerHTML = html;

     console.log(botMessage.innerhtml);
     chatBody.appendChild(botMessage);

 }

 // ìœ ì € ì±„íŒ… í‘œì‹œ
 function sayUser(message) {
     let chatBody = document.getElementById('chat-body');
     let userMessage = document.createElement('div');
     userMessage.classList.add('chat-box', 'sender');
     let html = '<div class="chat-text">';
     html += '  <div class="chat-bubble">' + message + '</div>';
     html += '</div>';
     html += '<div class="send-time">' + getFormattedNowTime() + '</div>';

     userMessage.innerHTML = html;
      
     chatBody.appendChild(userMessage);
 }

 // ì±„íŒ…ì°½ ë¹„ìš°ê¸°
 function refreshChat() {
     let chatBody = document.getElementById('chat-body');
     chatBody.innerHTML = ''; // ëŒ€í™”ì°½ì„ ëª¨ë‘ ë¹„ì›ë‹ˆë‹¤.
     sayBot("ì•ˆë…•! ì˜¤ëŠ˜ í•˜ë£¨ ì–´ë•Œ?");
 }

 function getFormattedNowTime() {
    const now = new Date();
    let hours = now.getHours();
    const minutes = now.getMinutes();
    const isPM = hours >= 12;

    // ì˜¤ì „/ì˜¤í›„ ì„¤ì •
    const period = isPM ? 'ì˜¤í›„' : 'ì˜¤ì „';

    // 12ì‹œê°„ì œë¡œ ë³€í™˜
    hours = hours % 12;
    hours = hours ? hours : 12; // 0ì‹œëŠ” 12ë¡œ ì„¤ì •

    // ë¶„ì— 0 ì¶”ê°€
    const formattedMinutes = minutes < 10 ? '0' + minutes : minutes;

    return `${period} ${hours}:${formattedMinutes}`;
}





</script>


</body>
</html>
